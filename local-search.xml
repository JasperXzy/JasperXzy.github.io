<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Python 自动化之纪念币预约</title>
    <link href="/article/auto_commemorative_coin_booking.html"/>
    <url>/article/auto_commemorative_coin_booking.html</url>
    
    <content type="html"><![CDATA[<h1 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h1><p>前段时间，2023 贺岁纪念币的预约如火如荼地进行着，当晚我也凭借惊人的手速抢到了 3 *20 &#x3D; 60 个，某天偶然打开农行预约纪念币网站，发现预约端口还未关闭，便想着用 Python 擅长的方面 - 自动化 来实现一站式全自动预约纪念币。</p><p class="note note-info">本文使用的技术包括但不仅限于：Python、Selenium-Python、OCR、Android adb</p><p><span class="label label-warning">声明：本文只用于技术分享，禁止使用本文代码参与各种不当获利行为</span></p><h1 id="Part-1：基本-Selenium-自动化"><a href="#Part-1：基本-Selenium-自动化" class="headerlink" title="Part 1：基本 Selenium 自动化"></a>Part 1：基本 Selenium 自动化</h1><p>打开<a href="https://eapply.abchina.com/coin/coin/Index">农行纪念币预约网址</a>，进入纪念币预约，可见布局如下：</p><p><img src="https://blog-jasperxzy.oss-cn-shanghai.aliyuncs.com/post_images/auto_commemorative_coin_booking/welcome_page.png" alt="welcome_page"></p><p>那么接下来就是基本的 Selenium 自动化了，<code>F12</code>打开开发者工具，查看 “ 预约 ” 的 Xpath，但通过两次纪念币预约，我发现该元素的 Xpath 是随纪念币更改的，故每次要提前进入该网址获取本次预约的 Xpath。</p><p class="info">将所有设置文件放在<code>general_settings.py</code>方便管理</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># general_settings.py</span><br><span class="hljs-keyword">from</span> selenium.webdriver.chrome.service <span class="hljs-keyword">import</span> Service <span class="hljs-keyword">as</span> Service_Chrome<br><br><br>path_chrome = Service_Chrome(<span class="hljs-string">&quot;./driver/chromedriver.exe&quot;</span>)<br>booking_url = <span class="hljs-string">&quot;https://eapply.abchina.com/coin/Coin/CoinIssuesDistribution?typeid=202301&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># main.py</span><br><span class="hljs-keyword">import</span> general_settings<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><span class="hljs-keyword">from</span> selenium.webdriver.common.by <span class="hljs-keyword">import</span> By<br><br><br>browser = webdriver.Chrome(service=general_settings.path_chrome)  <span class="hljs-comment"># 使用 Chrome 驱动</span><br>browser.get(general_settings.booking_url)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">welcome_page</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        欢迎页面</span><br><span class="hljs-string">        :return: None</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        browser.find_element(By.XPATH, general_settings.welcome_page_xpath).click()<br>        browser.find_element(By.XPATH, <span class="hljs-string">&#x27;//*[@id=&quot;I128&quot;]/button[1]&#x27;</span>).click()  <span class="hljs-comment"># 同意并继续</span><br></code></pre></td></tr></table></figure><p>接下来，进入今天我们的主战场，布局如下：</p><p><img src="https://blog-jasperxzy.oss-cn-shanghai.aliyuncs.com/post_images/auto_commemorative_coin_booking/booking_main.png" alt="booking_main"></p><p>我将此页面分为如下五个部分：</p><ol><li>基本个人信息（姓名、证件号码、手机号码）</li><li>图形验证码</li><li>短信验证码</li><li>兑换网点</li><li>兑换时间</li></ol><p>其中，1、4、5 在本 Part 展示，2、3 将在下文展示。</p><h2 id="1-基本个人信息"><a href="#1-基本个人信息" class="headerlink" title="1. 基本个人信息"></a>1. 基本个人信息</h2><p>由于本次自动化是多线程同时进行，且为了个人信息安全和后期再有纪念币预约可以直接使用，故将个人信息放入 MySQL 数据库中，使用 Python 第三方库 pymysql 获取数据库信息并填写。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># main.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">info_get</span>(<span class="hljs-params">host: <span class="hljs-built_in">str</span>, port: <span class="hljs-built_in">int</span>, user: <span class="hljs-built_in">str</span>, password: <span class="hljs-built_in">str</span>, database: <span class="hljs-built_in">str</span>, table: <span class="hljs-built_in">str</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        通过 MySQL 数据库获取信息</span><br><span class="hljs-string">        :param host: 主机名</span><br><span class="hljs-string">        :param port: 端口</span><br><span class="hljs-string">        :param user: 账户</span><br><span class="hljs-string">        :param password: 密码</span><br><span class="hljs-string">        :param database: 信息所在数据库</span><br><span class="hljs-string">        :param table: 信息所在表</span><br><span class="hljs-string">        :return: 信息的元组</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        info_MySQL = Connection(<br>            host=host,<br>            port=port,<br>            user=user,<br>            password=password<br>        )  <span class="hljs-comment"># 连接数据库</span><br>        cursor = info_MySQL.cursor() <br>        info_MySQL.select_db(database)  <br>        cursor.execute(<span class="hljs-string">f&#x27;SELECT *  FROM <span class="hljs-subst">&#123;table&#125;</span>;&#x27;</span>)<br>        result = cursor.fetchall()  <span class="hljs-comment"># 获取所有信息</span><br>        info_mysql = result[thread_index]  <span class="hljs-comment"># 获取对应进程的个人信息</span><br>        cursor.close()<br>        info_MySQL.close()<br>        <span class="hljs-keyword">return</span> info_mysql<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># main.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fill_info</span>(<span class="hljs-params">info: <span class="hljs-built_in">tuple</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        填写信息函数</span><br><span class="hljs-string">        :param info: 信息元组</span><br><span class="hljs-string">        :return: None</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        browser.find_element(By.XPATH, <span class="hljs-string">&#x27;//*[@id=&quot;name&quot;]&#x27;</span>).send_keys(info[<span class="hljs-number">1</span>])  <span class="hljs-comment"># 姓名</span><br>        browser.find_element(By.XPATH, <span class="hljs-string">&#x27;//*[@id=&quot;identNo&quot;]&#x27;</span>).send_keys(info[<span class="hljs-number">2</span>])  <span class="hljs-comment"># 身份证号</span><br>        browser.find_element(By.XPATH, <span class="hljs-string">&#x27;//*[@id=&quot;mobile&quot;]&#x27;</span>).send_keys(info[<span class="hljs-number">3</span>])  <span class="hljs-comment"># 电话号码</span><br></code></pre></td></tr></table></figure><h2 id="2-兑换网点"><a href="#2-兑换网点" class="headerlink" title="2. 兑换网点"></a>2. 兑换网点</h2><p>兑换网点是一个下拉框对象，故可以使用 Selenium 中 Select 函数对网点进行选择。</p>]]></content>
    
    
    <categories>
      
      <category>Tech</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Selenium</tag>
      
      <tag>Python</tag>
      
      <tag>OCR</tag>
      
      <tag>adb</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
